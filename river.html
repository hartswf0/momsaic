<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ripples on the River</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">

    <style>
        /* --- Base & Typography --- */
        :root {
            --primary: #0ea5e9; /* Sky 500 */
            --primary-dark: #0369a1; /* Sky 700 */
            --accent: #f43f5e; /* Rose 500 */
            --surface: #ffffff;
            --background: #f1f5f9; /* Slate 100 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #cbd5e1;
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, .fun-text { font-family: 'Nunito', sans-serif; }

        /* --- Device Frame (Desktop Only) --- */
        .device-frame {
            width: 100%;
            height: 100%;
            background: white;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @media (min-width: 640px) {
            .device-frame {
                width: 390px;
                height: 844px; /* iPhone 13/14 Pro dimensions */
                border-radius: 48px;
                box-shadow: 
                    0 0 0 12px #334155, 
                    0 25px 50px -12px rgba(0,0,0,0.5);
                border: 8px solid #1e293b;
            }
            /* Camera notch simulation */
            .device-frame::before {
                content: '';
                position: absolute;
                top: 0; left: 50%;
                transform: translateX(-50%);
                width: 120px;
                height: 28px;
                background: #1e293b;
                border-bottom-left-radius: 16px;
                border-bottom-right-radius: 16px;
                z-index: 50;
            }
        }

        /* --- Animations & Transitions --- */
        .slide-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #f8fafc;
        }

        .slide {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            overflow-y: auto;
            padding: 24px;
            padding-bottom: 100px; /* Space for footer */
            opacity: 0;
            transform: translateX(50px);
            transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
            display: none; /* Hide for accessibility/tabbing when inactive */
        }

        .slide.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: auto;
            display: block;
        }

        .slide.exit-left { transform: translateX(-50px); opacity: 0; }
        .slide.enter-right { transform: translateX(50px); opacity: 0; }

        /* --- UI Components --- */
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.04);
            border: 1px solid rgba(0,0,0,0.03);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn-primary:active { transform: scale(0.97); }

        .btn-option {
            background: white;
            border: 2px solid #e2e8f0;
            color: #64748b;
            transition: all 0.2s;
        }
        .btn-option.selected {
            border-color: var(--primary);
            background-color: #f0f9ff;
            color: var(--primary-dark);
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
        }

        /* Hide Scrollbar but allow scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        .pulse-ring::before {
            content: ''; absolute; inset: -4px; border-radius: 50%;
            border: 2px solid currentColor; animation: pulse-ring 2s infinite;
        }

    </style>
</head>
<body>

    <div class="device-frame">
        
        <!-- Header -->
        <header class="bg-white/80 backdrop-blur-md border-b border-slate-100 z-20 px-4 pt-10 pb-3 flex justify-between items-center sticky top-0">
            <div>
                <h1 class="text-lg font-extrabold text-slate-800 tracking-tight">Ripples on the River</h1>
                <div class="flex items-center gap-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-0.5">
                    <span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>
                    Science 4.PS4.1
                </div>
            </div>
            
            <button onclick="toggleTeacherMode()" class="p-2 rounded-full text-slate-400 hover:text-sky-600 hover:bg-sky-50 transition" title="Teacher View">
                <i class="ph-bold ph-chalkboard-teacher text-xl"></i>
            </button>
        </header>

        <!-- Progress Bar -->
        <div class="h-1 w-full bg-slate-100">
            <div id="progress-bar" class="h-full bg-sky-500 w-[25%] transition-all duration-500 ease-out shadow-[0_0_10px_rgba(14,165,233,0.5)]"></div>
        </div>

        <!-- Main Content Area -->
        <main class="slide-container" id="main-container">
            
            <!-- Slide 0: The Story -->
            <div class="slide active" id="slide-0">
                <div class="card p-6 mb-6 relative overflow-hidden group cursor-pointer" onclick="animateBoat()">
                    <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-sky-50 to-white -z-10"></div>
                    
                    <div class="flex items-center justify-between mb-4">
                        <span class="bg-sky-100 text-sky-700 text-xs font-bold px-2 py-1 rounded-md">Observation</span>
                        <i class="ph-fill ph-waves text-sky-300 text-2xl"></i>
                    </div>

                    <h2 class="text-2xl font-bold text-slate-800 mb-2">The Quiet River</h2>
                    <p class="text-slate-600 text-sm leading-relaxed mb-6">
                        You're fishing on a calm day. Your red bobber sits still on the water. Suddenly, a fast boat zooms by!
                    </p>

                    <!-- Mini Scene -->
                    <div class="h-32 w-full rounded-xl bg-sky-200 relative overflow-hidden border border-sky-300 shadow-inner">
                        <!-- Water -->
                        <div class="absolute bottom-0 w-full h-12 bg-sky-400/30 backdrop-blur-[1px]"></div>
                        
                        <!-- Bobber -->
                        <div id="story-bobber" class="absolute left-1/2 bottom-8 -translate-x-1/2 transition-transform duration-100">
                            <div class="w-0.5 h-4 bg-slate-800 mx-auto"></div>
                            <div class="w-5 h-5 bg-white rounded-full border border-slate-400 overflow-hidden relative shadow-sm">
                                <div class="absolute bottom-0 w-full h-2.5 bg-rose-500"></div>
                            </div>
                        </div>

                        <!-- Boat (Hidden initially off-screen) -->
                        <div id="story-boat" class="absolute top-4 -right-12 text-4xl transition-all duration-[1500ms] ease-linear opacity-0">
                            ðŸš¤
                        </div>
                    </div>
                    <p class="text-center text-xs font-bold text-sky-600 mt-3 uppercase tracking-wide opacity-70 animate-pulse">Tap to start the boat</p>
                </div>

                <div class="bg-indigo-50 border border-indigo-100 p-4 rounded-xl flex gap-3 items-start">
                    <i class="ph-fill ph-lightbulb text-indigo-500 text-xl shrink-0 mt-0.5"></i>
                    <div>
                        <h3 class="text-sm font-bold text-indigo-900">Think About It</h3>
                        <p class="text-xs text-indigo-700 leading-snug mt-1">
                            When the waves from the boat hit your bobber, does the bobber move <span class="font-bold underline">towards the shore</span> or just <span class="font-bold underline">bounce in place</span>?
                        </p>
                    </div>
                </div>
            </div>

            <!-- Slide 1: Experiment -->
            <div class="slide" id="slide-1">
                <div class="flex justify-between items-end mb-3 px-1">
                    <h2 class="text-xl font-bold text-slate-800">Wave Lab</h2>
                    <span class="text-[10px] font-bold bg-rose-100 text-rose-600 px-2 py-0.5 rounded-full">Interactive</span>
                </div>

                <!-- Simulation Canvas -->
                <div class="relative w-full aspect-[4/3] bg-gradient-to-b from-sky-100 to-sky-300 rounded-2xl border-2 border-white shadow-lg overflow-hidden mb-5">
                    <canvas id="waveCanvas" class="w-full h-full block cursor-crosshair"></canvas>
                    
                    <!-- Sim Controls -->
                    <div class="absolute top-3 right-3 flex flex-col gap-2">
                        <button onclick="simThrowRock()" class="bg-white/90 backdrop-blur text-slate-700 font-bold p-2.5 rounded-xl shadow-sm hover:scale-105 active:scale-95 transition border border-slate-200 group" title="Throw Rock">
                            <span class="text-lg group-hover:rotate-12 block transition-transform">ðŸª¨</span>
                        </button>
                    </div>
                    
                    <!-- HUD -->
                    <div class="absolute bottom-3 left-3 right-3 flex justify-between items-end pointer-events-none">
                        <div class="bg-slate-900/80 backdrop-blur text-white px-3 py-1.5 rounded-lg border border-slate-700">
                            <div class="text-[10px] text-slate-400 uppercase font-bold">Bobber Status</div>
                            <div id="sim-readout" class="font-mono text-sm font-bold text-yellow-400">STATIONARY</div>
                        </div>
                    </div>
                </div>

                <!-- Observation Task -->
                <div class="card p-5">
                    <h3 class="text-sm font-bold text-slate-800 mb-3">What happened to the bobber?</h3>
                    <div class="space-y-2.5">
                        <button onclick="checkObservation(this, false)" class="w-full text-left p-3.5 border-2 border-slate-100 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50 transition flex items-center gap-3 group">
                            <div class="w-5 h-5 rounded-full border-2 border-slate-300 group-hover:border-slate-400 flex items-center justify-center"></div>
                            It moved to the shore.
                        </button>
                        <button onclick="checkObservation(this, true)" class="w-full text-left p-3.5 border-2 border-slate-100 rounded-xl text-sm font-medium text-slate-600 hover:bg-slate-50 transition flex items-center gap-3 group">
                            <div class="w-5 h-5 rounded-full border-2 border-slate-300 group-hover:border-slate-400 flex items-center justify-center"></div>
                            It bounced up and down.
                        </button>
                    </div>
                    <div id="obs-feedback" class="hidden mt-4 bg-green-50 text-green-700 p-3 rounded-xl text-xs font-bold border border-green-200 flex items-center gap-2 animate-bounce-in">
                        <i class="ph-fill ph-check-circle text-lg"></i>
                        <span>Correct! Matter moves up & down. Energy moves forward.</span>
                    </div>
                </div>
            </div>

            <!-- Slide 2: Diagram -->
            <div class="slide" id="slide-2">
                <h2 class="text-xl font-bold text-slate-800 mb-4 px-1">Anatomy of a Wave</h2>
                
                <div class="card p-1 mb-5 border-0 shadow-md">
                    <svg viewBox="0 0 320 160" class="w-full rounded-xl bg-slate-50">
                        <!-- Grid -->
                        <defs>
                            <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e2e8f0" stroke-width="1"/>
                            </pattern>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grid)"/>
                        
                        <!-- Axis -->
                        <line x1="10" y1="80" x2="310" y2="80" stroke="#94a3b8" stroke-dasharray="4"/>
                        <text x="15" y="75" font-size="8" fill="#94a3b8" font-family="sans-serif">Rest Position</text>

                        <!-- The Wave -->
                        <path id="wave-path" d="M10,80 Q47.5,10 85,80 T160,80 T235,80 T310,80" fill="none" stroke="#0ea5e9" stroke-width="4" stroke-linecap="round"/>

                        <!-- Animations Groups -->
                        <g id="label-amp" class="opacity-0 transition-opacity duration-500">
                            <line x1="47.5" y1="80" x2="47.5" y2="10" stroke="#f43f5e" stroke-width="2"/>
                            <circle cx="47.5" cy="10" r="3" fill="#f43f5e"/>
                            <rect x="55" y="30" width="70" height="18" rx="4" fill="white" stroke="#f43f5e" stroke-width="1"/>
                            <text x="60" y="42" font-size="10" font-weight="bold" fill="#f43f5e" font-family="sans-serif">AMPLITUDE</text>
                        </g>

                        <g id="label-wave" class="opacity-0 transition-opacity duration-500">
                            <line x1="47.5" y1="15" x2="197.5" y2="15" stroke="#8b5cf6" stroke-width="2"/>
                            <line x1="47.5" y1="20" x2="47.5" y2="10" stroke="#8b5cf6" stroke-width="2"/>
                            <line x1="197.5" y1="20" x2="197.5" y2="10" stroke="#8b5cf6" stroke-width="2"/>
                            <rect x="85" y="5" width="75" height="18" rx="4" fill="white" stroke="#8b5cf6" stroke-width="1"/>
                            <text x="90" y="17" font-size="10" font-weight="bold" fill="#8b5cf6" font-family="sans-serif">WAVELENGTH</text>
                        </g>
                    </svg>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="toggleDiagram('amp')" class="bg-white border-2 border-rose-100 hover:border-rose-400 p-4 rounded-xl shadow-sm text-left transition group active:scale-95">
                        <div class="w-8 h-8 rounded-lg bg-rose-100 text-rose-600 flex items-center justify-center mb-2 group-hover:scale-110 transition">
                            <i class="ph-bold ph-arrows-vertical text-lg"></i>
                        </div>
                        <div class="text-xs font-bold text-rose-500 uppercase tracking-wider mb-1">Height</div>
                        <div class="text-sm font-bold text-slate-700">Amplitude</div>
                    </button>

                    <button onclick="toggleDiagram('wave')" class="bg-white border-2 border-violet-100 hover:border-violet-400 p-4 rounded-xl shadow-sm text-left transition group active:scale-95">
                        <div class="w-8 h-8 rounded-lg bg-violet-100 text-violet-600 flex items-center justify-center mb-2 group-hover:scale-110 transition">
                            <i class="ph-bold ph-arrows-horizontal text-lg"></i>
                        </div>
                        <div class="text-xs font-bold text-violet-500 uppercase tracking-wider mb-1">Length</div>
                        <div class="text-sm font-bold text-slate-700">Wavelength</div>
                    </button>
                </div>
                
                <p class="mt-6 text-center text-xs text-slate-400 italic">Tap the cards to reveal parts of the wave.</p>
            </div>

            <!-- Slide 3: Exit Ticket -->
            <div class="slide" id="slide-3">
                <div class="text-center mb-6">
                    <div class="inline-block p-3 rounded-full bg-yellow-100 text-yellow-600 mb-3 text-3xl animate-float">ðŸŽ“</div>
                    <h2 class="text-2xl font-bold text-slate-800">Show What You Know</h2>
                    <p class="text-slate-500 text-sm">Answer 2 quick questions to finish!</p>
                </div>

                <div class="space-y-6 mb-8">
                    <!-- Q1 -->
                    <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100">
                        <p class="text-sm font-bold text-slate-800 mb-3"><span class="text-sky-500 mr-2">1.</span>Waves move energy, NOT _______.</p>
                        <div class="flex gap-2">
                            <button onclick="selectAnswer('q1', 'Matter', this)" class="btn-option flex-1 py-2.5 rounded-lg text-sm font-bold">Matter</button>
                            <button onclick="selectAnswer('q1', 'Sound', this)" class="btn-option flex-1 py-2.5 rounded-lg text-sm font-bold">Sound</button>
                            <button onclick="selectAnswer('q1', 'Light', this)" class="btn-option flex-1 py-2.5 rounded-lg text-sm font-bold">Light</button>
                        </div>
                    </div>

                    <!-- Q2 -->
                    <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100">
                        <p class="text-sm font-bold text-slate-800 mb-3"><span class="text-sky-500 mr-2">2.</span>In the lab, the bobber moved:</p>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="selectAnswer('q2', 'sideways', this)" class="btn-option p-3 rounded-lg flex flex-col items-center gap-1 hover:bg-slate-50">
                                <i class="ph-duotone ph-arrow-right text-2xl mb-1"></i>
                                <span class="text-xs font-bold">Sideways</span>
                            </button>
                            <button onclick="selectAnswer('q2', 'updown', this)" class="btn-option p-3 rounded-lg flex flex-col items-center gap-1 hover:bg-slate-50">
                                <i class="ph-duotone ph-arrows-vertical text-2xl mb-1"></i>
                                <span class="text-xs font-bold">Up & Down</span>
                            </button>
                        </div>
                    </div>
                </div>

                <button id="submit-btn" onclick="submitAssessment()" class="w-full btn-primary py-4 rounded-xl text-lg font-bold shadow-lg shadow-sky-200 opacity-50 cursor-not-allowed" disabled>
                    Submit Answers
                </button>
            </div>

            <!-- Slide 4: Success/Teacher Feedback -->
            <div class="slide" id="slide-success">
                <div class="h-full flex flex-col items-center justify-center text-center p-6">
                    <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center text-5xl mb-6 shadow-sm animate-bounce">
                        ðŸŒŸ
                    </div>
                    <h2 class="text-3xl font-extrabold text-slate-800 mb-2">Great Job!</h2>
                    <p class="text-slate-600 text-lg mb-8">You are a wave expert.</p>
                    
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 w-full max-w-xs transform rotate-1">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Score</div>
                        <div class="text-4xl font-black text-sky-500">100%</div>
                    </div>

                    <button onclick="resetApp()" class="mt-12 text-slate-400 font-bold text-sm hover:text-sky-600 transition">Start Over</button>
                </div>
            </div>

        </main>

        <!-- Navigation Bar -->
        <nav class="bg-white border-t border-slate-100 px-6 py-4 flex justify-between items-center z-20 shrink-0">
            <button onclick="navigate(-1)" id="nav-prev" class="w-12 h-12 rounded-full flex items-center justify-center text-slate-300 hover:text-slate-600 hover:bg-slate-50 transition disabled:opacity-0">
                <i class="ph-bold ph-arrow-left text-2xl"></i>
            </button>

            <div class="flex gap-2">
                <div class="w-2 h-2 rounded-full bg-sky-500 nav-dot transition-all"></div>
                <div class="w-2 h-2 rounded-full bg-slate-200 nav-dot transition-all"></div>
                <div class="w-2 h-2 rounded-full bg-slate-200 nav-dot transition-all"></div>
                <div class="w-2 h-2 rounded-full bg-slate-200 nav-dot transition-all"></div>
            </div>

            <button onclick="navigate(1)" id="nav-next" class="w-12 h-12 rounded-full flex items-center justify-center text-white bg-slate-900 shadow-md hover:bg-slate-700 hover:scale-105 active:scale-95 transition disabled:opacity-0 disabled:bg-slate-200">
                <i class="ph-bold ph-arrow-right text-2xl"></i>
            </button>
        </nav>

        <!-- Teacher Overlay (Hidden by default) -->
        <div id="teacher-view" class="absolute inset-0 bg-slate-900/95 z-50 p-8 hidden backdrop-blur-md text-white flex-col">
            <div class="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
                <h2 class="text-2xl font-bold">Teacher Guide</h2>
                <button onclick="toggleTeacherMode()" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700"><i class="ph-bold ph-x"></i></button>
            </div>

            <div class="space-y-4 overflow-y-auto no-scrollbar">
                <div class="bg-slate-800 p-4 rounded-xl border-l-4 border-yellow-400">
                    <h4 class="font-bold text-yellow-400 text-sm uppercase mb-1">Common Misconception</h4>
                    <p class="text-sm text-slate-300">Students often think the water travels with the wave. Emphasize in Slide 2 that the <span class="text-white font-bold">bobber stays in place</span> vertically.</p>
                </div>

                <div class="bg-slate-800 p-4 rounded-xl border-l-4 border-sky-500">
                    <h4 class="font-bold text-sky-400 text-sm uppercase mb-1">Standard 4.PS4.1</h4>
                    <p class="text-sm text-slate-300">Develop a model of waves to describe patterns in terms of amplitude and wavelength and that waves can cause objects to move.</p>
                </div>

                <div class="bg-slate-800 p-4 rounded-xl">
                    <h4 class="font-bold text-white text-sm uppercase mb-2">Answer Key</h4>
                    <div class="space-y-2 text-sm text-slate-400">
                        <div class="flex justify-between"><span>Q1: Transport</span> <span class="text-green-400">Energy</span></div>
                        <div class="flex justify-between"><span>Q2: Motion</span> <span class="text-green-400">Up & Down</span></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- State Management ---
        let currentSlide = 0;
        const totalSlides = 4; // 0, 1, 2, 3 (Success is hidden 4)
        let simRunning = false;
        let answers = { q1: null, q2: null };

        // --- Navigation ---
        function navigate(direction) {
            const slides = document.querySelectorAll('.slide');
            const oldSlide = currentSlide;
            
            // Boundary Check
            if (direction === 1 && currentSlide >= totalSlides - 1) return;
            if (direction === -1 && currentSlide <= 0) return;

            currentSlide += direction;

            // Update Progress UI
            updateUI(oldSlide, currentSlide);

            // Trigger Slide Specific Logic
            if (currentSlide === 1) startSimulation();
        }

        function updateUI(prev, next) {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.nav-dot');
            const bar = document.getElementById('progress-bar');
            const prevBtn = document.getElementById('nav-prev');
            const nextBtn = document.getElementById('nav-next');

            // Slide Transition Logic
            slides[prev].classList.remove('active');
            slides[next].classList.add('active');

            // Animation classes based on direction
            /* Note: In a real React app we'd use AnimatePresence, here simple class toggling is sufficient for the effect */

            // Progress Bar & Dots
            bar.style.width = `${((next + 1) / totalSlides) * 100}%`;
            
            dots.forEach((dot, idx) => {
                if (idx === next) {
                    dot.classList.add('bg-sky-500', 'w-6');
                    dot.classList.remove('bg-slate-200', 'w-2');
                } else {
                    dot.classList.remove('bg-sky-500', 'w-6');
                    dot.classList.add('bg-slate-200', 'w-2');
                }
            });

            // Button States
            prevBtn.disabled = next === 0;
            // Next button is hidden on exit ticket until complete, handled separately
            if (next === 3) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'flex';
                nextBtn.disabled = next === totalSlides;
            }
        }

        // --- Slide 0: Story Animation ---
        function animateBoat() {
            const boat = document.getElementById('story-boat');
            const bobber = document.getElementById('story-bobber');
            
            boat.style.opacity = '1';
            boat.style.transform = 'translateX(-350px)'; // Move across screen

            // Bobber reaction with delay
            setTimeout(() => {
                bobber.classList.add('animate-bounce');
                setTimeout(() => bobber.classList.remove('animate-bounce'), 2000);
            }, 800);

            // Reset boat for replay
            setTimeout(() => {
                boat.style.transition = 'none';
                boat.style.opacity = '0';
                boat.style.transform = 'translateX(0)';
                // Force reflow
                void boat.offsetWidth;
                boat.style.transition = 'all 1500ms linear';
            }, 2500);
        }

        // --- Slide 1: Canvas Physics ---
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        let waves = [];
        let animationId;
        
        function resizeCanvas() {
            canvas.width = canvas.parentElement.offsetWidth * 2; // Retina scale
            canvas.height = canvas.parentElement.offsetHeight * 2;
            ctx.scale(2, 2);
        }

        function startSimulation() {
            if (simRunning) return;
            simRunning = true;
            resizeCanvas();
            animate();
        }

        function simThrowRock() {
            waves.push({ x: -20, amplitude: 30, speed: 3, width: 0.1 });
            // Add a visual splash text maybe?
        }

        function animate() {
            const w = canvas.width / 2;
            const h = canvas.height / 2;
            ctx.clearRect(0, 0, w, h);

            // Sky
            const grd = ctx.createLinearGradient(0, 0, 0, h);
            grd.addColorStop(0, '#e0f2fe');
            grd.addColorStop(1, '#bae6fd');
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, w, h);

            // Water Params
            const waterLevel = h * 0.6;
            const bobberX = w * 0.7;
            let bobberY = waterLevel;
            let bobberDy = 0; // Velocity for readout

            ctx.beginPath();
            ctx.moveTo(0, h);
            ctx.lineTo(0, waterLevel);

            // Draw Wave
            for (let x = 0; x <= w; x += 2) {
                let y = waterLevel;
                // Sum of waves
                waves.forEach(wave => {
                    const dist = x - wave.x;
                    // Gaussian packet
                    const displacement = Math.sin(dist * wave.width) * wave.amplitude * Math.exp(-(dist * dist) / 2000);
                    y += displacement;
                });
                
                ctx.lineTo(x, y);

                if (Math.abs(x - bobberX) < 2) {
                    bobberY = y;
                    bobberDy = bobberY - waterLevel; // approx velocity/displacement
                }
            }

            ctx.lineTo(w, h);
            ctx.fillStyle = "rgba(14, 165, 233, 0.4)";
            ctx.fill();
            
            // Surface Line
            ctx.strokeStyle = "#0ea5e9";
            ctx.lineWidth = 3;
            ctx.stroke();

            // Draw Bobber
            ctx.save();
            ctx.translate(bobberX, bobberY);
            
            // Stick
            ctx.beginPath();
            ctx.moveTo(0, -15);
            ctx.lineTo(0, 5);
            ctx.strokeStyle = "#334155";
            ctx.lineWidth = 2;
            ctx.stroke();

            // Float Body
            ctx.beginPath();
            ctx.arc(0, 0, 8, 0, Math.PI * 2);
            ctx.fillStyle = "white";
            ctx.fill();
            ctx.strokeStyle = "#94a3b8";
            ctx.lineWidth = 1;
            ctx.stroke();

            // Red Bottom
            ctx.beginPath();
            ctx.arc(0, 0, 8, 0, Math.PI, false);
            ctx.fillStyle = "#f43f5e";
            ctx.fill();
            
            ctx.restore();

            // Physics Update
            waves.forEach(wave => {
                wave.x += wave.speed;
                wave.amplitude *= 0.995; // Damping
            });
            waves = waves.filter(w => w.amplitude > 0.5 && w.x < w + 200);

            // HUD Update
            const readout = document.getElementById('sim-readout');
            if (Math.abs(bobberDy) > 1) {
                readout.innerText = "MOVING: UP/DOWN";
                readout.classList.remove('text-yellow-400');
                readout.classList.add('text-rose-500', 'animate-pulse');
            } else {
                readout.innerText = "STATIONARY";
                readout.classList.add('text-yellow-400');
                readout.classList.remove('text-rose-500', 'animate-pulse');
            }

            animationId = requestAnimationFrame(animate);
        }

        function checkObservation(btn, isCorrect) {
            if (isCorrect) {
                // Select visual
                const all = btn.parentElement.querySelectorAll('button');
                all.forEach(b => b.classList.remove('border-green-500', 'bg-green-50'));
                
                btn.classList.remove('border-slate-100');
                btn.classList.add('border-green-500', 'bg-green-50');
                
                // Show feedback
                document.getElementById('obs-feedback').classList.remove('hidden');
                
                // Change circle icon
                const circle = btn.querySelector('div');
                circle.innerHTML = '<i class="ph-bold ph-check text-green-600 text-xs"></i>';
                circle.classList.remove('border-slate-300');
                circle.classList.add('border-green-500', 'bg-green-200');
            } else {
                btn.classList.add('animate-shake', 'border-rose-300', 'bg-rose-50');
                setTimeout(() => btn.classList.remove('animate-shake', 'border-rose-300', 'bg-rose-50'), 500);
            }
        }

        // --- Slide 2: Diagram ---
        function toggleDiagram(part) {
            const el = document.getElementById('label-' + part);
            // Simple toggle logic
            if (el.classList.contains('opacity-0')) {
                el.classList.remove('opacity-0');
            } else {
                el.classList.add('opacity-0');
            }
        }

        // --- Slide 3: Exit Ticket ---
        function selectAnswer(q, val, btn) {
            answers[q] = val;
            
            // Visual selection within the group
            const group = btn.parentElement;
            const buttons = group.querySelectorAll('button');
            buttons.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');

            // Check if ready to submit
            const submitBtn = document.getElementById('submit-btn');
            if (answers.q1 && answers.q2) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function submitAssessment() {
            // Check correctness (simple check)
            if (answers.q1 === 'Matter' && answers.q2 === 'updown') {
                // Show Success Slide
                document.getElementById('slide-3').classList.remove('active');
                document.getElementById('slide-success').classList.add('active');
                document.getElementById('nav-prev').style.display = 'none'; // Hide nav
                document.querySelector('nav').style.display = 'none'; // Hide footer nav bar
            } else {
                alert("Almost! Remember, energy moves, matter stays put. Try again!");
            }
        }

        function resetApp() {
            location.reload();
        }

        // --- Teacher Mode ---
        function toggleTeacherMode() {
            const view = document.getElementById('teacher-view');
            if (view.classList.contains('hidden')) {
                view.classList.remove('hidden');
                view.classList.add('flex');
            } else {
                view.classList.add('hidden');
                view.classList.remove('flex');
            }
        }

        // Init
        window.addEventListener('resize', () => { if(simRunning) resizeCanvas(); });
    </script>
</body>
</html>

